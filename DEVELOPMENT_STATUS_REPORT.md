# ERPcheck 개발 상태 보고서
**작성일:** 2025-12-17
**버전:** Current Head

## 1. 개요 (Executive Summary)
**ERPcheck**는 기존 ERP 시스템(`http://sook0517.cafe24.com`)을 위한 **고성능 "헤드리스 프론트엔드"** 역할을 하는 Electron 데스크탑 애플리케이션입니다. 기존 ERP 웹 인터페이스의 한계를 극복하기 위해 최신 UX(React/Tailwind)와 브라우저 자동화(Playwright) 기술을 결합했습니다.

*   **핵심 강점:** **교육 관리(Education Management)** 모듈은 기존 ERP와의 완벽한 양방향 동기화(읽기/쓰기/수정/삭제)를 지원하며 매우 높은 완성도를 보입니다.
*   **현재 상태:** 일상 업무(일정 확인, 로그 작성)에 즉시 투입 가능한 수준입니다. "예약 연동(Reservation Integration)" 모듈은 후반 프로토타입 단계(실제 로직과 테스트 데이터 혼재)입니다.
*   **아키텍처:** Electron(Main)이 Playwright(헤드리스 브라우저)를 제어하여 실제 작업을 수행하며, React(Renderer)는 UI를 담당하고 보안 IPC를 통해 Electron과 통신합니다.

---

## 2. 아키텍처 및 파일 구조 분석

### 2.1 백엔드 (Electron Main Process)
**디렉토리:** `electron/`
애플리케이션의 "두뇌"입니다. 스크래핑, 세션 관리, 데이터베이스(ERP) 상호작용 등 모든 복잡한 작업을 처리합니다.

| 파일명 | 상태 | 역할 및 기능 |
| :--- | :--- | :--- |
| **`main.ts`** | ✅ 안정 | **애플리케이션 진입점**. Electron 윈도우 생성, 데이터 영구 저장을 위한 `electron-store` 초기화, IPC 호출 라우팅을 담당합니다. |
| **`preload.ts`** | ✅ 안정 | **보안 브리지**. React 프론트엔드가 Node.js에 직접 접근하지 않고 안전하게 백엔드 기능을 호출할 수 있도록 `window.api` 객체를 노출합니다. |
| **`services/ErpService.ts`** | 🚀 **핵심** | **ERP 자동화 엔진**. 가장 복잡한 파일(1100줄+)로, Playwright 브라우저 인스턴스를 관리하며 로그인, 달력 판독, 학생 기록 CRUD 작업을 ERP DOM 레벨에서 직접 수행합니다. |
| **`services/scraperService.ts`** | ⚠️ 베타 | **외부 스크래퍼**. **네이버 파트너센터**와 **카카오 비즈니스**에서 예약 데이터를 가져오기 위해 설계되었습니다. 현재 네이버(DOM 스크래핑)와 카카오(텍스트 파싱) 로직이 구현되어 있으나, 외부 사이트 변경에 취약할 수 있습니다. |
| **`services/types.ts`** | ✅ 안정 | 공통 데이터 구조(Student, DailyData)에 대한 TypeScript 정의 파일입니다. |

### 2.2 프론트엔드 (React Renderer)
**디렉토리:** `src/`
애플리케이션의 "얼굴"입니다. Vite와 Tailwind CSS로 구축된 현대적인 SPA(Single Page Application)입니다.

| 파일명 | 상태 | 역할 및 기능 |
| :--- | :--- | :--- |
| **`App.tsx`** | ✅ 안정 | **라우터 및 레이아웃**. 대시보드, 교육, 예약, 설정 탭 전환을 관리합니다. 기본값은 "교육 관리" 탭입니다. |
| **`components/education/EducationManager.tsx`** | ⭐ **MVP** | **핵심 기능**. 일일 학생 교육 로그를 관리하는 분할 뷰 인터페이스입니다. <br>• **목록 뷰:** 상태별 색상 표시(점).<br>• **상세 뷰:** 이력 읽기/수정/삭제.<br>• **일괄 전송:** 다수의 로그를 한 번에 전송.<br>• **임시 저장:** 전송 전 로컬 "작성 중" 상태 지원. |
| **`components/reservation/ReservationCollector.tsx`** | 🚧 베타 | **예약 통합기**. 네이버/카카오 예약을 수집하여 ERP와 대조합니다. <br>• **수집:** 스크래퍼 호출.<br>• **대조:** 중복/충돌 감지 로직.<br>• **등록:** ERP 원클릭 등록. <br>• *참고:* 현재 테스트용 "Mock Data" 버튼이 포함되어 있습니다. |
| **`components/dashboard/Dashboard.tsx`** | ⚪ 비어있음 | **홈 화면**. 현재는 정적 플레이스홀더(0명, 0건)만 있으며, 실제 데이터와 연결되지 않았습니다. |
| **`components/Settings.tsx`** | ✅ 안정 | **설정**. ERP 로그인 ID/비밀번호를 로컬 스토리지(`electron-store`)에 안전하게 저장하는 UI입니다. |

---

## 3. 기능 상세 분석

### 3.1 교육 관리 (`EducationManager` + `ErpService`)
**상태: 매우 성숙함 (Highly Mature)**
이 모듈은 프로젝트의 핵심 가치입니다. 기존 ERP의 다양한 엣지 케이스(팝업, jQuery 이벤트, 특정 버튼 탐색 난이도 등)를 처리하는 백엔드 로직이 놀라울 정도로 견고합니다.

*   **데이터 읽기:**
    *   FullCalendar 인터페이스를 스크래핑하여 "오늘"의 이벤트를 가져옵니다.
    *   차단 방지를 위해 요청 속도를 지능적으로 조절(Throttling)합니다.
    *   ERP 내부 API(`getBookingInfo`)의 복잡한 JSON/HTML 응답을 파싱합니다.
*   **데이터 쓰기:**
    *   **개별 수정:** 모달 내 특정 이력 행을 정확히 식별하여 수정/삭제할 수 있습니다.
    *   **일괄 쓰기:** 여러 학생의 로그를 큐에 담아 순차적으로 효율적으로 기록합니다.
    *   **복구:** 브라우저가 종료되면 자동으로 재시작하고 재로그인을 수행합니다.

### 3.2 예약 연동 (`ReservationCollector` + `ScraperService`)
**상태: 실험적 / 진행 중 (In-Progress)**
네이버 예약 데이터를 ERP로 자동 이관하는 것이 목표입니다.

*   **네이버 스크래핑:** `scraperService`에 구현되어 있으나, `BookingListView__` 와 같은 DOM 선택자는 네이버 사이트 업데이트 시 깨질 위험이 높습니다 (유지보수 필요).
*   **ERP 동기화:** ERP에 예약을 생성(`createReservation`)하는 로직은 구현되었으나, 실제 데이터 필드 매핑에 대한 검증이 더 필요합니다.
*   **UI:** 체크박스로 선택 후 "ERP 등록"을 수행하는 데이터 그리드 UI는 준비되었습니다.

### 3.3 대시보드
**상태: 플레이스홀더**
*   현재는 "껍데기" UI만 존재합니다. `ErpService`와 연결하여 "오늘 교육 인원 5명"과 같은 실제 데이터를 표시하도록 작업해야 합니다.

---

## 4. 향후 과제 및 로드맵

### 우선순위 1: 안정화
*   **스크래퍼 내구성 강화:** `scraperService.ts`의 네이버/카카오 스크래퍼에 대해 외부 사이트 변경 시 쉽게 대응할 수 있는 에러 핸들링 및 "Selector Map" 구조 도입이 필요합니다.
*   **대시보드 연결:** `Dashboard.tsx`를 `erp:getTodayEducation`과 연결하여 앱 시작 시 실제 현황을 보여주도록 해야 합니다.

### 우선순위 2: 기능 완성
*   **예약 동기화 검증:** "예약 생성" 흐름을 실제 데이터로 철저히 테스트하여 ERP에 중복되거나 잘못된 데이터가 생성되지 않도록 해야 합니다.

### 우선순위 3: 모바일/확장
*   현재 아키텍처는 모바일 확장을 고려해 서비스/UI가 분리되어 있으나, `Playwright`(Node.js 전용) 의존도가 높습니다. 모바일로 포팅하려면 스크래핑 레이어를 별도 API 서버로 분리하는 등의 재설계가 필요할 수 있습니다.

---

## 5. 개발자 참고 사항 (Technical Notes)
*   **헤드리스 모드:** `ErpService`의 `this.isHeadless`로 제어됩니다. 프론트엔드 상단에 있는 "브라우저 표시" 체크박스로 실시간 전환이 가능합니다.
*   **인증 관리:** ERP 자격 증명은 `AppData` 경로에 `electron-store`를 통해 저장됩니다. 세션 만료 시 `ErpService`가 자동으로 재로그인을 시도합니다.
*   **IPC 보안:** `contextIsolation: true`가 활성화되어 있어 보안상 안전합니다. `remote` 모듈을 사용하지 않습니다.
