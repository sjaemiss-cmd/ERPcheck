# 운영고수 (Operation Master) 프로젝트 구조 및 파일 설명

이 문서는 '운영고수' 프로그램의 파일 구조와 각 파일의 역할을 설명합니다. 모든 파일의 내용을 마지막 줄까지 확인하고 작성되었습니다.

## 1. 프로젝트 개요
'운영고수'는 운전면허 학원 또는 연습장의 운영 관리를 돕는 데스크톱 애플리케이션입니다. ERP 시스템(Cafe24 기반), 네이버 예약, 카카오 비즈니스 센터와 연동하여 예약 정보를 수집하고, ERP에 자동으로 등록하거나 일정을 확인하는 기능을 제공합니다.

## 2. 핵심 파일 설명

### `gui.py` (메인 프로그램)
- **역할**: 프로그램의 진입점(Entry Point)이자 메인 GUI(그래픽 사용자 인터페이스)를 담당합니다. `PyQt6` 라이브러리를 사용합니다.
- **주요 클래스 및 기능**:
  - **`MainWindow`**: 메인 윈도우 프레임. 탭 위젯(`QTabWidget`)을 통해 '교육관리', '예약 수집', '설정' 탭을 구성하고, 시스템 트레이 아이콘(`QSystemTrayIcon`)을 초기화합니다.
  - **`EducationManagerWidget`**: '교육관리' 탭의 UI.
    - `ERPClient`를 이용해 금일 교육생 목록을 가져옵니다.
    - `SmartLogEditor`를 포함하여 교육생의 메모(일지)를 작성하고 수정할 수 있습니다.
    - `BatchMemoWriter` 스레드를 통해 작성된 메모를 ERP에 일괄 전송합니다.
    - `schedule` 라이브러리를 사용하여 평일 20시, 주말 17시에 자동으로 교육 내역을 확인하는 스케줄러가 포함되어 있습니다.
  - **`ReservationCollectorWidget`**: '예약 수집' 탭의 UI.
    - `NaverWorker`, `KakaoWorker`를 통해 예약 데이터를 수집하고 `QTableWidget`에 표시합니다.
    - `CalendarWorker`를 통해 향후 2주간의 ERP 일정을 가져와 중복 여부 및 영업시간 준수 여부를 확인합니다(`run_check_availability`).
    - `ERPWorker`를 통해 선택된 예약을 ERP에 등록합니다(`run_register`).
  - **`SettingsWidget`**: '설정' 탭의 UI.
    - ERP 아이디/비밀번호를 입력받아 `QSettings`에 저장합니다.
    - 윈도우 시작 시 자동 실행(`Run` 레지스트리 등록) 및 프로그램 실행 시 자동 조회 옵션을 관리합니다.
  - **`SmartLogEditor`**: 교육생의 과거 이력과 메모를 보여주고 새 메모를 작성하는 커스텀 위젯입니다.

### `erp_client.py` (ERP 연동 모듈)
- **역할**: Cafe24 기반의 ERP 시스템과 통신하는 핵심 모듈입니다. Microsoft Playwright를 사용하여 웹 브라우저를 자동화합니다.
- **주요 기능**:
  - **로그인 (`login`)**: 저장된 자격 증명으로 ERP 시스템에 로그인합니다.
  - **일정 확인 (`get_daily_reservations`)**: 금일 예약된 교육생 목록을 가져옵니다. JS(`fullCalendar('clientEvents')`)를 실행하여 캘린더 데이터를 직접 추출하고, 각 회원의 상세 정보(메모, 사진 등)를 모달을 통해 수집합니다.
  - **주간 일정 (`get_weekly_schedule`)**: 향후 2주간의 일정 데이터를 수집하여 스케줄러 뷰에 제공합니다.
  - **가능 여부 확인 (`check_availability`)**: 특정 날짜/시간의 예약 가능 여부를 확인합니다. 중복 예약 및 좌석(호기) 점유 상태를 체크합니다.
  - **예약 등록 (`create_reservation`)**: 수집된 예약 정보를 바탕으로 ERP 캘린더에 새 예약을 자동으로 등록합니다. 날짜/시간 설정, 회원 정보 입력, 상품 및 옵션 선택, 결제 수단 선택 등을 자동화합니다.
  - **메모 작성 (`write_memo`, `write_memos_batch`)**: 교육생의 교육 일지(메모)를 ERP 회원 정보에 자동으로 기입합니다. 모달 창을 제어하여 날짜와 내용을 입력하고 저장합니다.

### `naver_client.py` (네이버 예약 연동)
- **역할**: 네이버 예약 파트너 센터에서 예약 내역을 수집합니다.
- **주요 기능**:
  - **로그인**: 사용자가 직접 브라우저를 통해 로그인하면 세션 쿠키를 `naver_session.json`에 저장하여 재사용합니다.
  - **예약 수집**: 저장된 세션을 이용해 예약 목록(신청, 확정 상태)을 스크래핑합니다. 상품명, 옵션, 요청사항, 연락처 등을 파싱하여 정제된 데이터를 반환합니다.

### `kakao_client.py` (카카오톡 채널 연동)
- **역할**: 카카오 비즈니스 센터의 채팅 목록을 수집합니다.
- **주요 기능**:
  - **로그인**: 네이버와 마찬가지로 수동 로그인 후 세션을 `kakao_session.json`에 저장합니다.
  - **채팅 수집**: 채팅 목록을 가져와 예약 관련 문의나 정보를 수집하는 용도로 사용됩니다.

### `scheduler_widget.py` (주간 스케줄러 위젯 - 현재 미사용)
- **역할**: 주간 일정표를 시각적으로 보여주는 커스텀 PyQt 위젯입니다.
- **상태**: 예약 수집 탭의 UI가 테이블 뷰로 변경되면서 현재는 사용되지 않고 있습니다. `QGraphicsView`를 사용하여 시간표 그리드와 드래그 가능한 예약 아이템을 구현했습니다.

### `goodsinfo.ini` (상품 정보 데이터)
- **역할**: ERP 시스템의 상품 선택 드롭다운 메뉴에 있는 HTML 옵션 태그들을 저장한 파일입니다.
- **용도**: `erp_client.py`가 예약 등록 시 올바른 상품(1종, 2종, 시간제 등)을 선택하기 위해 이 파일의 정보를 참조하거나 매핑 로직의 기초 데이터로 활용됩니다.

### `requirements.txt` (의존성 목록)
- **역할**: 프로젝트 실행에 필요한 파이썬 라이브러리 목록입니다.
- **내용**: `playwright`, `python-dotenv`, `python-dateutil`. (`PyQt6`는 `gui.py`에서 사용되지만 이 파일에는 명시되어 있지 않을 수 있어 확인이 필요합니다. 현재 파일 내용에는 위 3개만 기재되어 있습니다.)

### `README.md` (프로젝트 설명)
- **역할**: 프로젝트의 개요, 기술 스택, 구조, 실행 방법을 설명하는 문서입니다.
- **내용**: Electron 마이그레이션 관련 내용이 주를 이루고 있으며, 현재 Python 버전과는 다소 차이가 있는 레거시 정보가 포함되어 있습니다.

### `.env.example` (환경변수 예시)
- **역할**: `.env` 파일의 템플릿입니다.
- **내용**: `ERP_ID`, `ERP_PASSWORD` 등의 환경변수 키 예시가 들어있습니다.

### `.gitignore` (Git 무시 설정)
- **역할**: Git 버전 관리에서 제외할 파일 목록을 지정합니다.
- **내용**: 가상환경 폴더(`.venv`), 빌드 아티팩트(`build/`, `dist/`), 세션 파일(`*_session.json`), 로그 파일(`debug.log`), 실행 파일(`*.exe`) 등이 포함되어 있습니다.

## 3. 데이터 흐름
1. **사용자**가 `gui.py`를 실행합니다.
2. **예약 수집**: 사용자가 '예약 수집' 버튼을 누르면 `gui.py`가 `naver_client.py` (또는 카카오)를 호출하여 예약 데이터를 가져옵니다.
3. **데이터 표시**: 수집된 데이터는 `gui.py`의 테이블에 표시됩니다.
4. **가능 여부 확인**: 사용자가 확인 버튼을 누르면 `erp_client.py`의 `check_availability`가 호출되어 ERP 캘린더를 조회하고 중복 여부를 체크합니다.
5. **ERP 등록**: 사용자가 등록 버튼을 누르면 `erp_client.py`의 `create_reservation`이 호출되어 ERP 시스템에 접속, 예약 폼을 자동으로 작성하고 저장합니다.
6. **교육 관리**: '교육 관리' 탭에서는 `erp_client.py`의 `get_daily_reservations`를 통해 금일 교육생 목록을 가져오고, `write_memo`를 통해 교육 내용을 저장합니다.

## 4. 기타 파일
- `*.spec`: PyInstaller를 사용하여 실행 파일(.exe)을 만들 때 사용되는 설정 파일들입니다. (`.gitignore`에 의해 내용은 확인되지 않았으나, 일반적인 PyInstaller 설정 파일입니다.)
- `*.json` (session 파일): 네이버/카카오 로그인 세션 정보를 저장하여 재로그인 번거로움을 줄입니다.
- `debug.log`: 프로그램 실행 중 발생하는 오류나 중요 정보를 기록하는 로그 파일입니다.
